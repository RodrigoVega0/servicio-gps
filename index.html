<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Formulario GPS - Secusystem</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: #333;
      min-height: 100vh;
      padding: 20px;
      line-height: 1.6;
    }

    .container {
      max-width: 1000px;
      margin: 0 auto;
    }

    .header {
      text-align: center;
      margin-bottom: 30px;
      background: rgba(255, 255, 255, 0.95);
      padding: 30px;
      border-radius: 20px;
      box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
      backdrop-filter: blur(10px);
    }

    .header h1 {
      color: #000080;
      font-size: clamp(28px, 5vw, 36px);
      font-weight: 700;
      margin-bottom: 10px;
      text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
    }

    .header p {
      color: #666;
      font-size: 16px;
      margin: 0;
    }

    .form-container {
      background: rgba(255, 255, 255, 0.95);
      padding: 40px;
      border-radius: 20px;
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.2);
    }

    .form-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 25px;
      margin-bottom: 30px;
    }

    .form-group {
      display: flex;
      flex-direction: column;
    }

    .form-group.full-width {
      grid-column: 1 / -1;
    }

    label {
      font-weight: 600;
      margin-bottom: 8px;
      color: #2c3e50;
      font-size: 14px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    input, select, textarea {
      width: 100%;
      padding: 15px;
      border: 2px solid #e1e8ed;
      border-radius: 12px;
      font-size: 16px;
      transition: all 0.3s ease;
      background: #fff;
      font-family: inherit;
    }

    input:focus, select:focus, textarea:focus {
      outline: none;
      border-color: #000080;
      box-shadow: 0 0 0 4px rgba(0, 0, 128, 0.1);
      transform: translateY(-2px);
    }

    input:hover, select:hover, textarea:hover {
      border-color: #34495e;
    }

    textarea {
      height: 100px;
      resize: vertical;
      font-family: inherit;
    }

    .file-input-container {
      position: relative;
      overflow: hidden;
      display: inline-block;
      width: 100%;
    }

    .file-input {
      position: absolute;
      left: -9999px;
    }

    .file-input-label {
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 15px;
      background: linear-gradient(135deg, #74b9ff, #0984e3);
      color: white;
      border-radius: 12px;
      cursor: pointer;
      transition: all 0.3s ease;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      border: none;
    }

    .file-input-label:hover {
      transform: translateY(-3px);
      box-shadow: 0 10px 25px rgba(116, 185, 255, 0.4);
    }

    .photo-preview {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
      gap: 15px;
      margin-top: 20px;
    }

    .photo-item {
      position: relative;
      border-radius: 12px;
      overflow: hidden;
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
      transition: transform 0.3s ease;
    }

    .photo-item:hover {
      transform: scale(1.05);
    }

    .photo-preview img {
      width: 100%;
      height: 150px;
      object-fit: cover;
      display: block;
    }

    .button-container {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 15px;
      margin-top: 30px;
    }

    .btn {
      padding: 18px 30px;
      font-size: 16px;
      font-weight: 600;
      border: none;
      border-radius: 12px;
      cursor: pointer;
      transition: all 0.3s ease;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      position: relative;
      overflow: hidden;
    }

    .btn-primary {
      background: linear-gradient(135deg, #000080, #4169E1);
      color: white;
    }

    .btn-primary:hover {
      transform: translateY(-3px);
      box-shadow: 0 15px 30px rgba(0, 0, 128, 0.4);
    }

    .btn-secondary {
      background: linear-gradient(135deg, #e74c3c, #c0392b);
      color: white;
    }

    .btn-secondary:hover {
      transform: translateY(-3px);
      box-shadow: 0 15px 30px rgba(231, 76, 60, 0.4);
    }

    .btn:active {
      transform: translateY(-1px);
    }

    /* Responsive Design */
    @media (max-width: 768px) {
      body {
        padding: 10px;
      }

      .form-container {
        padding: 25px;
      }

      .form-grid {
        grid-template-columns: 1fr;
        gap: 20px;
      }

      .header {
        padding: 20px;
      }

      .button-container {
        grid-template-columns: 1fr;
      }

      .photo-preview {
        grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
      }
    }

    @media (max-width: 480px) {
      .form-container {
        padding: 20px;
      }

      input, select, textarea {
        padding: 12px;
        font-size: 14px;
      }

      .btn {
        padding: 15px 20px;
        font-size: 14px;
      }
    }

    /* Loading Animation */
    .loading {
      opacity: 0.7;
      pointer-events: none;
      position: relative;
    }

    .loading::after {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 20px;
      height: 20px;
      border: 2px solid #fff;
      border-top: 2px solid transparent;
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      0% { transform: translate(-50%, -50%) rotate(0deg); }
      100% { transform: translate(-50%, -50%) rotate(360deg); }
    }

    /* Success Animation */
    .success-message {
      background: linear-gradient(135deg, #00b894, #00a085);
      color: white;
      padding: 15px;
      border-radius: 12px;
      margin-top: 20px;
      text-align: center;
      font-weight: 600;
      opacity: 0;
      transform: translateY(-20px);
      transition: all 0.3s ease;
    }

    .success-message.show {
      opacity: 1;
      transform: translateY(0);
    }
  </style>
</head>
<body>

<div class="container">
  <div class="header">
    <h1>Secusystem</h1>
    <p>Sistema de Gesti√≥n GPS - Formulario de Servicio</p>
  </div>

  <div class="form-container">
    <form id="gps-form">
      <div class="form-grid">
        <div class="form-group">
          <label>üë§ Nombre del Cliente:</label>
          <input type="text" id="nombre" placeholder="Ingrese el nombre completo" />
        </div>
        
        <div class="form-group">
          <label>üî¢ Cuenta Protrack:</label>
          <input type="text" id="cuenta" placeholder="N√∫mero de cuenta" />
        </div>
        
        <div class="form-group">
          <label>üìû Tel√©fono:</label>
          <input type="tel" id="telefono" placeholder="(55) 1234-5678" />
        </div>
        
        <div class="form-group">
          <label>üìß Email:</label>
          <input type="email" id="email" placeholder="ejemplo@correo.com" />
        </div>
        
        <div class="form-group">
          <label>üì± Modelo GPS:</label>
          <input type="text" id="modelo" placeholder="Modelo del dispositivo" />
        </div>
        
        <div class="form-group">
          <label>üî¢ IMEI:</label>
          <input type="text" id="imei" placeholder="N√∫mero IMEI" />
        </div>
        
        <div class="form-group">
          <label>üìã SIM:</label>
          <input type="text" id="sim" placeholder="N√∫mero de SIM" />
        </div>
        
        <div class="form-group">
          <label>üë®‚Äçüîß T√©cnico:</label>
          <input type="text" id="tecnico" placeholder="Nombre del t√©cnico" />
        </div>
        
        <div class="form-group">
          <label>üìÖ Fecha de Instalaci√≥n:</label>
          <input type="date" id="fecha" />
        </div>
        
        <div class="form-group">
          <label>üöó Marca Veh√≠culo:</label>
          <input type="text" id="marca" placeholder="Toyota, Ford, etc." />
        </div>
        
        <div class="form-group">
          <label>üè∑Ô∏è Modelo Veh√≠culo:</label>
          <input type="text" id="modeloVehiculo" placeholder="Corolla, Focus, etc." />
        </div>
        
        <div class="form-group">
          <label>üìÖ A√±o:</label>
          <input type="text" id="anio" placeholder="2020" />
        </div>
        
        <div class="form-group">
          <label>‚öôÔ∏è Tipo de Servicio:</label>
          <select id="tipo">
            <option>Instalaci√≥n</option>
            <option>Desmonto</option>
            <option>Reinstalaci√≥n</option>
            <option>Revisi√≥n</option>
          </select>
        </div>
        
        <div class="form-group">
          <label>üîß Corte:</label>
          <select id="corte">
            <option>Bomba</option>
            <option>Ignici√≥n</option>
            <option>Corriente Continua</option>
            <option>Sin Paro</option>
          </select>
        </div>
        
        <div class="form-group">
          <label>üí∞ Costo del Servicio:</label>
          <input type="text" id="costo" placeholder="$0.00" />
        </div>
        
        <div class="form-group">
          <label>üè† Renta:</label>
          <input type="text" id="renta" placeholder="$0.00" />
        </div>
        
        <div class="form-group full-width">
          <label>üí¨ Comentarios:</label>
          <textarea id="descripcion" placeholder="Descripci√≥n detallada del servicio realizado..."></textarea>
        </div>
        
        <div class="form-group full-width">
          <label>üì∏ Fotos:</label>
          <div class="file-input-container">
            <input type="file" id="fotos" accept="image/*" multiple class="file-input" />
            <label for="fotos" class="file-input-label">
              üìÅ Seleccionar Fotos
            </label>
          </div>
          <div class="photo-preview" id="preview"></div>
        </div>
      </div>
      
      <div class="button-container">
        <button type="button" class="btn btn-primary" onclick="descargarPDF()">
          üìÑ Descargar PDF
        </button>
        <button type="button" class="btn btn-secondary" onclick="limpiarDatos()">
          üóëÔ∏è Limpiar Datos
        </button>
      </div>
      
      <div id="success-message" class="success-message">
        ‚úÖ Datos limpiados correctamente
      </div>
    </form>
  </div>
</div>

<script>
  const { jsPDF } = window.jspdf;

  // Preview de fotos mejorado
  document.getElementById('fotos').addEventListener('change', function () {
    const preview = document.getElementById('preview');
    preview.innerHTML = '';
    
    Array.from(this.files).forEach((file, index) => {
      const reader = new FileReader();
      reader.onload = function (e) {
        const photoItem = document.createElement('div');
        photoItem.className = 'photo-item';
        
        const img = document.createElement('img');
        img.src = e.target.result;
        img.alt = `Foto ${index + 1}`;
        
        photoItem.appendChild(img);
        preview.appendChild(photoItem);
      };
      reader.readAsDataURL(file);
    });
  });

  // Funci√≥n para limpiar todos los datos
  function limpiarDatos() {
    // Confirmar acci√≥n
    if (confirm('¬øEst√°s seguro de que deseas limpiar todos los datos del formulario?')) {
      // Limpiar todos los inputs de texto
      const textInputs = document.querySelectorAll('input[type="text"], input[type="email"], input[type="tel"], input[type="date"]');
      textInputs.forEach(input => input.value = '');
      
      // Resetear selects a su primera opci√≥n
      const selects = document.querySelectorAll('select');
      selects.forEach(select => select.selectedIndex = 0);
      
      // Limpiar textarea
      const textarea = document.querySelector('textarea');
      if (textarea) textarea.value = '';
      
      // Limpiar input de archivos y preview
      const fileInput = document.getElementById('fotos');
      fileInput.value = '';
      document.getElementById('preview').innerHTML = '';
      
      // Mostrar mensaje de √©xito
      mostrarMensajeExito();
    }
  }

  // Funci√≥n para mostrar mensaje de √©xito
  function mostrarMensajeExito() {
    const mensaje = document.getElementById('success-message');
    mensaje.classList.add('show');
    
    setTimeout(() => {
      mensaje.classList.remove('show');
    }, 3000);
  }

  // Funci√≥n mejorada para descargar PDF
  function descargarPDF() {
    const btnDescargar = document.querySelector('.btn-primary');
    btnDescargar.classList.add('loading');
    btnDescargar.textContent = 'Generando PDF...';
    
    setTimeout(() => {
      const doc = new jsPDF();
      const cuenta = document.getElementById('cuenta').value.trim() || 'reporte';
      let y = 15;

      // Encabezado mejorado
      doc.setFontSize(18);
      doc.setTextColor(0, 0, 128);
      doc.text("SECUSYSTEM", 105, y, null, null, "center");
      
      doc.setFontSize(12);
      doc.setTextColor(100, 100, 100);
      y += 8;
      doc.text("Sistema de Gesti√≥n GPS - Reporte de Servicio", 105, y, null, null, "center");

      doc.setFontSize(10);
      doc.setTextColor(0, 0, 0);
      y += 15;

      function writeField(label, value) {
        if (y > 270) {
          doc.addPage();
          y = 20;
        }
        doc.setFont(undefined, "bold");
        doc.text(`${label}:`, 10, y);
        doc.setFont(undefined, "normal");
        doc.text(`${value || 'Sin datos'}`, 70, y);
        y += 8;
      }

      // Informaci√≥n del cliente
      doc.setFont(undefined, "bold");
      doc.setFontSize(12);
      doc.text("INFORMACI√ìN DEL CLIENTE", 10, y);
      y += 10;
      doc.setFontSize(10);

      writeField("Nombre del Cliente", document.getElementById("nombre").value);
      writeField("Cuenta Protrack", cuenta);
      writeField("Tel√©fono", document.getElementById("telefono").value);
      writeField("Email", document.getElementById("email").value);

      y += 5;
      doc.setFont(undefined, "bold");
      doc.setFontSize(12);
      doc.text("INFORMACI√ìN DEL EQUIPO", 10, y);
      y += 10;
      doc.setFontSize(10);

      writeField("Modelo GPS", document.getElementById("modelo").value);
      writeField("IMEI", document.getElementById("imei").value);
      writeField("SIM", document.getElementById("sim").value);

      y += 5;
      doc.setFont(undefined, "bold");
      doc.setFontSize(12);
      doc.text("INFORMACI√ìN DEL SERVICIO", 10, y);
      y += 10;
      doc.setFontSize(10);

      writeField("T√©cnico", document.getElementById("tecnico").value);
      writeField("Fecha de Instalaci√≥n", document.getElementById("fecha").value);
      writeField("Tipo de Servicio", document.getElementById("tipo").value);
      writeField("Corte", document.getElementById("corte").value);
      writeField("Costo del Servicio", "$" + document.getElementById("costo").value);
      writeField("Renta", "$" + document.getElementById("renta").value);

      y += 5;
      doc.setFont(undefined, "bold");
      doc.setFontSize(12);
      doc.text("INFORMACI√ìN DEL VEH√çCULO", 10, y);
      y += 10;
      doc.setFontSize(10);

      writeField("Marca Veh√≠culo", document.getElementById("marca").value);
      writeField("Modelo Veh√≠culo", document.getElementById("modeloVehiculo").value);
      writeField("A√±o", document.getElementById("anio").value);

      const comentarios = document.getElementById("descripcion").value;
      if (comentarios) {
        y += 5;
        doc.setFont(undefined, "bold");
        doc.setFontSize(12);
        doc.text("COMENTARIOS", 10, y);
        y += 10;
        doc.setFontSize(10);
        doc.setFont(undefined, "normal");
        
        const lineas = doc.splitTextToSize(comentarios, 180);
        lineas.forEach(linea => {
          if (y > 270) {
            doc.addPage();
            y = 20;
          }
          doc.text(linea, 10, y);
          y += 6;
        });
      }

      const files = document.getElementById("fotos").files;
      if (files.length > 0) {
        doc.addPage();
        y = 20;
        doc.setFont(undefined, "bold");
        doc.setFontSize(12);
        doc.text("FOTOGRAF√çAS DEL SERVICIO", 10, y);
        y += 15;
        
        let x = 10;
        let fotosAgregadas = 0;
        
        Array.from(files).slice(0, 6).forEach((file, index) => {
          const reader = new FileReader();
          reader.onload = function (e) {
            try {
              doc.addImage(e.target.result, "JPEG", x, y, 80, 60);
              x += 90;
              
              if ((index + 1) % 2 === 0) {
                x = 10;
                y += 70;
              }
              
              fotosAgregadas++;
              if (fotosAgregadas === Math.min(files.length, 6)) {
                finalizarPDF();
              }
            } catch (error) {
              console.log('Error al agregar imagen:', error);
              fotosAgregadas++;
              if (fotosAgregadas === Math.min(files.length, 6)) {
                finalizarPDF();
              }
            }
          };
          reader.readAsDataURL(file);
        });
      } else {
        finalizarPDF();
      }

      function finalizarPDF() {
        doc.save(`formulario_GPS_${cuenta}_${new Date().toISOString().split('T')[0]}.pdf`);
        
        // Restaurar bot√≥n
        btnDescargar.classList.remove('loading');
        btnDescargar.textContent = 'üìÑ Descargar PDF';
      }

      if (files.length === 0) {
        finalizarPDF();
      }
    }, 1000);
  }

  // Auto-guardar fecha actual si est√° vac√≠a
  document.addEventListener('DOMContentLoaded', function() {
    const fechaInput = document.getElementById('fecha');
    if (!fechaInput.value) {
      const hoy = new Date().toISOString().split('T')[0];
      fechaInput.value = hoy;
    }
  });

  // Formateo autom√°tico de campos monetarios
  document.getElementById('costo').addEventListener('input', function(e) {
    let value = e.target.value.replace(/[^\d.]/g, '');
    if (value) {
      e.target.value = value;
    }
  });

  document.getElementById('renta').addEventListener('input', function(e) {
    let value = e.target.value.replace(/[^\d.]/g, '');
    if (value) {
      e.target.value = value;
    }
  });
</script>

</body>
</html>
